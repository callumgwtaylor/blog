---
title: Downloading data from HDX easily in a tidy format; hdxr and hdx_resource_csv()
author: ~
date: '2017-06-11'
slug: downloading-datasets-from-hdx-in-an-easier-pipeline-and-a-tidy-format-hdxr-and-hdx-resource-csv
categories: []
tags: []
Categories: R
Description: ''
Tags: R, hdxr, tidyverse, ckanr
---

## An easier pipeline for Humanitarian Data Exchange, with a tidy format

I've been trying to make it easier to extract data from HDX in R, using tidyverse packages. I've started compiling a mini-package called hdxr that wraps these pipelines up neatly. I've added a new function today `hdx_resource_csv` that means to download datasets from HDX all you need to do is the following:

```
library(hdxr)
hdx_connect()
datasets <- hdx_package_search(term = "141121-sierra-leone-health-facilities") %>%
  hdx_resource_list() %>%
  hdx_resource_csv()
```

I've described most of these functions in previous [posts](https://callumgwtaylor.github.io/blog/2017/06/04/mini-package-hdxr/), but basically:

`hdx_connect` uses `ckanr` to connect to the hdx ckan server

`hdx_package_search` will search hdx for the packages you're looking for and return a dataframe. (You can use `hdx_list` to find titles of datasets)

`hdx_resource_list` will take that dataframe and use `tidyverse` features to extract information about the datasets themselves.

### hdx_resource_csv

The new function `hdx_resource_csv` will take the results of `hdx_resource_list`, and return a new dataframe. This will have three columns:

- **identifier** this has a title merged from the package and dataset titles
- **location** this is the url where the csv was downloaded from
- **csv** this is a nested dataframe downloaded from the location url

hdx_resource_csv provides a nested dataframe column to allow a sensible output when you download multiple csvs all with different columns in one go.

When you want to extract a particular csv to work with, you can use `dplyr::filter()` and `tidyr::unnest()` to get at it. You could just unnest without filtering, but when every csv has different column titles, the output is a bit messy.

#### Example:

```{r example_workflow, message=FALSE, warning=FALSE}
library(tidyverse)
library(hdxr)
hdx_connect()
datasets <- hdx_package_search(term = "141121-sierra-leone-health-facilities") %>%
  hdx_resource_list() %>%
  hdx_resource_csv()
```

The above would give us a dataframe that looks like:
![](https://raw.githubusercontent.com/callumgwtaylor/blog/master/content/data/2017_06_11_pipelines/example_output.png?token=AKjYFXSVM3_lBhDeWmg3bNygg9C2gPqJks5ZRqgUwA%3D%3D)

you can then select what you want with filter and unnest it:

```{r example_unnest, message=FALSE, warning=FALSE}
sierra_leone_healthsites_sbtf_sle_health <- datasets %>%
  filter(dataset_identifier == "sierra-leone-healthsites_sbtf-sle-health") %>%
  unnest()
```

![](https://raw.githubusercontent.com/callumgwtaylor/blog/master/content/data/2017_06_11_pipelines/example_dataframe.png?token=AKjYFWJnUiBkJelzKrCGj40n_t_ZJFAKks5ZRqg9wA%3D%3D)

#### Any use? Wrong way of doing things?

I think this pipeline makes sense for me to extract data from HDX. And the majority of files on there are CSV. If you've thoughts of how I should do it differently, please let me know either on [github](https://github.com/callumgwtaylor/hdxr) directly or just through [twitter](https://twitter.com/CallumGWT)

If you want to try it yourself, download and installation instructions are on the [github readme](https://github.com/callumgwtaylor/hdxr).
