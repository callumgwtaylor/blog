---
title: Cholera in Yemen - mapping deaths from the current epidemic using HDX in R
author: ~
date: '2017-07-03'
slug: cholera-in-yemen
categories: []
tags: []
Categories: R
Description: ''
Tags: 
  - R
  - hdxr
  - sf
  - cholera
  - Yemen
  - gganimate
---

```{r start, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(hdxr)
library(ggplot2)
library(gganimate)
library(wesanderson)
```

```{r data, message=FALSE, warning=FALSE, include=FALSE}
hdx_connect()
yemen_map <- hdx_dataset_search("yemen-admin-boundaries", exact = TRUE) %>%
  hdx_resource_list() %>%
  filter(name.resources == "Admin-1.zip") %>%
  hdx_resource_shapefile() 

yemen_data <- hdx_dataset_search("yemen-cholera-outbreak-daily-epidemiology-update", exact = TRUE) %>%
  hdx_resource_list() %>%
  hdx_resource_csv() %>%
  unnest() %>%
  rename(admin1Name = `COD Gov English`)

yemen_data$Date <- as.Date(yemen_data$Date)
```

```{r filter_map, message=FALSE, warning=FALSE, include=FALSE}
yemen_map_filtered <- yemen_map %>%
  select(admin1Name, geometry)
```

```{r updated_data, message=FALSE, warning=FALSE, include=FALSE}
deaths_data <- yemen_data %>%
  select(Date, admin1Name, Deaths) %>%
  filter(!is.na(admin1Name)) %>% 
  distinct() %>%
  spread(key = Date, value = Deaths)

deaths_data <- left_join(yemen_map_filtered, deaths_data, by = "admin1Name")


deaths_data <- deaths_data %>%
  gather("date", "deaths", 4:22)
deaths_data$date <- as.Date(deaths_data$date)


cases_data <- yemen_data %>%
  select(Date, admin1Name, Cases) %>%
  filter(!is.na(admin1Name)) %>%
  distinct() %>%
  spread(key = Date, value = Cases)

cases_data <- left_join(yemen_map_filtered, cases_data, by = "admin1Name")


cases_data <- cases_data %>%
  gather("date", "cases", 4:22)
cases_data$date <- as.Date(cases_data$date)
```

```{r joined_data_info, message=FALSE, warning=FALSE, include=FALSE}
joined_data <- cases_data %>%
  select(admin1Name, date, cases) %>%
  left_join(deaths_data, by = c("admin1Name", "date"))
```

## Cholera in Yemen

At the time of writing this, the WHO has released information about 218798 cases of Cholera in Yemen, with 1400 deaths.

This information has been collated by the Humanitarian Data Exchange (HDX), and put [online](https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update). I made a new function for [hdxr](https://callumgwtaylor.github.io/hdxr/) the other day to make it easier to use maps from HDX, and wanted to learn more about what's happening in Yemen.

All the information below has been taken from HDX and read into R using hdxr

I don't know why but mortality rates seems to vary a lot between administrative districts. Amanat Al-Asimah, containing Sana'a, Yemen's largest city, has had the most cholera cases in the country (33349) but only 53 deaths. Whereas Hajjah, has had almost 9000 fewer cases (24566), but over four times the amount of deaths (223).

I've included a table showing the differing mortality rates. I don't know enough about Cholera or Yemen to explain it, but I'd be suprised if that variation is all real. I'd assume that some regions (Raymah) are more likely to report deaths than cases, giving an increased mortality, whereas a major city like Sana'a might be more likely to report every case, bringing it's overall mortality down.

## Cholera Deaths

```{r deaths_maps, echo=FALSE, message=FALSE, warning=FALSE}
pal <- wes_palette("Zissou", 21, type = "continuous")
  
yemen_deaths_gif <- joined_data %>%
  ggplot() +
  geom_sf(aes(fill = deaths, frame = date)) +
  theme_bw() +
  scale_fill_gradientn(colours = pal) +
  labs(title = "Cholera Deaths in Yemen",
      subtitle = "Cumulative total of deaths in each administrative area",
      caption = "data from https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update")

gganimate(yemen_deaths_gif, "../../static/post/2017-07-03-cholera-in-yemen-mapping-deaths-from-the-current-epidemic_files/figure-html/yemen_deaths_gif.gif", ani.width=1000, ani.height=500)
```

![](/post/2017-07-03-cholera-in-yemen-mapping-deaths-from-the-current-epidemic_files/figure-html/yemen_deaths_gif.gif)



```{r deaths_line_graph, echo=FALSE, fig.height=6, fig.width=8, message=FALSE, warning=FALSE}
death_graph <- ggplot(joined_data) +
  geom_line(aes(x = date, y = deaths)) +
  facet_wrap(~admin1Name) +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle=45, hjust = 1, vjust = 1)) +
  labs(x = "Date",
       y = "Deaths",
      title = "Cholera Deaths in Yemen",
      subtitle = "Cumulative total of deaths in each administrative area",
      caption = "data from https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update")


death_graph
```

## Cholera Cases

```{r cases_maps, echo=FALSE, message=FALSE, warning=FALSE}
pal <- wes_palette("Zissou", 21, type = "continuous")
  
yemen_cases_gif <- joined_data %>%
  ggplot() +
  geom_sf(aes(fill = cases, frame = date)) +
  theme_bw() +
  scale_fill_gradientn(colours = pal) +
  labs(title = "Cholera Cases in Yemen",
      subtitle = "Cumulative total of cases in each administrative area",
      caption = "data from https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update")

gganimate(yemen_cases_gif, "../../static/post/2017-07-03-cholera-in-yemen-mapping-deaths-from-the-current-epidemic_files/figure-html/yemen_cases_gif.gif", ani.width=1000, ani.height=500)
```

![](/post/2017-07-03-cholera-in-yemen-mapping-deaths-from-the-current-epidemic_files/figure-html/yemen_cases_gif.gif)

```{r cases_line, echo=FALSE, fig.height=6, fig.width=8, message=FALSE, warning=FALSE}
cases_graph <- ggplot(joined_data) +
  geom_line(aes(x = date, y = cases)) +
  facet_wrap(~admin1Name) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust = 1, vjust = 1)) +
  labs(x = "Date",
       y = "Cases",
      title = "Cholera Cases in Yemen",
       subtitle = "Cumulative total of cases in each administrative area",
       caption = "data from https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update")

cases_graph
```

### Cholera Deaths Table

```{r deaths_table, echo=FALSE, message=FALSE, warning=FALSE}
 joined_data %>%
   filter(date == "2017-06-26") %>%
   ungroup() %>%
   select(admin1Name, deaths, cases) %>%
   rename(`Administrative District` = admin1Name,
          Deaths = deaths,
          Cases = cases) %>%
   arrange(desc(Deaths)) %>%
   head() %>%
   knitr::kable(digits = 4)
```


### Cholera Cases Table

```{r cases_table, echo=FALSE, message=FALSE, warning=FALSE}
joined_data %>%
  filter(date == "2017-06-26") %>%
  ungroup() %>%
  select(admin1Name, deaths, cases) %>%
  rename(`Administrative District` = admin1Name,
         Deaths = deaths,
         Cases = cases) %>%
  arrange(desc(Cases)) %>%
  head() %>%
  knitr::kable()
```

### Cholera Mortality Percentage Table

```{r mortality_table, echo=FALSE, message=FALSE, warning=FALSE}
joined_data %>%
  filter(date == "2017-06-26") %>%
  ungroup() %>%
  filter(!is.na(cases)) %>%
  select(admin1Name, deaths, cases) %>%
  mutate(mortality = (deaths/cases)*100) %>%
    rename(`Administrative District` = admin1Name,
         Deaths = deaths,
         Cases = cases,
         `Percentage Mortality` = mortality) %>%
  arrange(desc(`Percentage Mortality`)) %>%
  knitr::kable()
```

